{% extends "base.html" %}<!--extends the base.html template-->

{% block title %}Search{% endblock %}<!--Override the default name from the base.html template-->

{% block content %}

<div class="w3-container" style="margin-top:128px" id="search">
  <div class="text-light w3-black">
    <h1 class="w3-center">{{Info["longName"]}}</h1>
  </div>
  <p class="w3-wide">Symbol: <span id="symbol">{{Info["symbol"]}}</span></p>
  <p class="w3-wide">Current Price: $<span id="dayHigh">{{Info["currentPrice"]}}</span></p>  
  <div class="conatainer" style="width:900px;">
        <canvas id="myChart"></canvas>
        <button id="day" class="w3-button w3-black">1 day</button>
        <button id="mo3" class="w3-button w3-black">3 months</button>
        <button id="mo6" class="w3-button w3-black">6 months</button>
        <button id="year" class="w3-button w3-black">1 year</button>
        <button id="year5" class="w3-button w3-black">5 years</button>
        <button id="year10" class="w3-button w3-black">10 year</button>
  </div>
</div>
<div>
  <table>
    <th>Date</th>
    <th>Firm</th>
    <th>Recomendation</th>
  {% for i in range(5)%}
    <tr>
      <td>{{recomend['dates'][i]}}</td>
      <td>{{recomend['firms'][i]}}</td>
      <td>{{recomend['grades'][i]}} </td>
    </tr>
  {% endfor %}
  </table>
</div>

<div>
  <h1>Price history</h1>
  <p> 52 Week High</p>
  <p>{{Info['fiftyTwoWeekHigh']}}</p>
  <p>52 week Low</p>
  <p>{{Info['fiftyTwoWeekLow']}}</p>
  <p>50 day average</p>
  <p>{{Info['fiftyDayAverage']}}</p>
  <p> 200 day average</p>
  <p>{{Info['twoHundredDayAverage']}}</p>
</div>


<div>
  <h1>value measures</h1>
  <p>Market cap</p>
  <p>{{Info['marketCap']}}</p>
  <p>Trailing P/E</p>
  <p>{{Info['trailingPE']}}<p>
  <p>forward P/E </p>
  <p>{{Info['forwardPE']}}</p>
  <p>Price to sales in the last 12 months</p>
  <p>{{Info['priceToSalesTrailing12Months']}}<p>
  <p>Price to book value</p>
  <p>{{Info['priceToBook']}}<p>
  <p></p>
</div>




<!--About the company-->
<div class="w3-container" style="margin-top:64px">
  <div class="text-light w3-black">
    <h2 class="w3-center">About {{Info["longName"]}}</h2>
  </div>
  <p> {{Info["longBusinessSummary"]}}</p>
</div>
<!--Information-->

</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let bottom = JSON.parse({{ dates | tojson }})
  let income = JSON.parse({{ money | tojson }})
  let newmychart=stockGraph(bottom,income)

  function determineColor(price){
    let colors=[]
    for(i=0;i<price.length;i++){
      if ( price[0] > price[i] ){
        colors.push("#880808")
      }
      else{
        colors.push("#bae755")
      }
    }
    return colors
  }


  let stockName=document.getElementById("symbol").textContent;
  let day=document.getElementById("day");
  let mo3=document.getElementById("mo3");
  let mo6=document.getElementById("mo6");
  let year=document.getElementById("year");
  let year5=document.getElementById("year5");
  let year10=document.getElementById("year10");
  let id =setInterval(write,6000)

  let keepGoing=true
  let counter=0
  day.addEventListener("click",()=>{
    keepGoing=true
    write()
    id =setInterval(write,6000)
  });

  function write(){
    if(keepGoing){
    datas = getdata(stockName,'1d')
    if (newmychart.data.datasets[0].data.length==datas[1].length){
      counter=counter +1
    }
    if (counter==2)
    {
      console.log("finish")
      clearInterval(id)
      counter =0
    }
    newmychart.data.labels=datas[0]
    newmychart.data.datasets[0].data=datas[1]
    newmychart.update()
    }
  }

  mo3.addEventListener("click",()=>{
    keepGoing=false
    datas = getdata(stockName,'3mo')
    newmychart.data.labels=datas[0]
    newmychart.data.datasets[0].data=datas[1]
    newmychart.update();
  });

  mo6.addEventListener("click",()=>{
    keepGoing=false
    datas = getdata(stockName,'6mo')
    newmychart.data.labels=datas[0]
    newmychart.data.datasets[0].data=datas[1]
    newmychart.update();
  });

  year.addEventListener("click",()=>{
    keepGoing=false
    datas = getdata(stockName,'1y')
    newmychart.data.labels=datas[0]
    newmychart.data.datasets[0].data=datas[1]
    newmychart.update();
  });

  year5.addEventListener("click",()=>{
    keepGoing=false
    datas = getdata(stockName,'5y')
    newmychart.data.labels=datas[0]
    newmychart.data.datasets[0].data=datas[1]
    newmychart.update();
  });

  year10.addEventListener("click",()=>{
    keepGoing=false
    datas = getdata(stockName,'10y')
    console.log(datas[0])
    newmychart.data.labels=datas[0]
    newmychart.data.datasets[0].data=datas[1]
    newmychart.update();
  });

<<<<<<< HEAD
  function stockGraph(x_axis,y_axis){
    let ctx = document.getElementById("myChart").getContext("2d");
    const data = {
    labels: x_axis,
=======
  function stockGraph(){
  let ctx = document.getElementById("myChart").getContext("2d");
  colors = determineColor(income)
  const data = {
    labels: bottom,
>>>>>>> b1e46beb6a510b8acdd4ac00f9c07eaf93bc223e
    datasets: [{
      label: 'My First Dataset',
      data: y_axis,
      fill: false,
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.1
      }]
    };
    const config = {
      type: 'line',
      data: data,
    };
    return new Chart(ctx,config)
}

  function getdata(stock,time){
    let xhr = new XMLHttpRequest();
    let date
    let price
    xhr.open('GET','http://127.0.0.1:5000/search?time='+time+'&stock='+stock,false);
    xhr.onload= function(){
      if(this.status == 200){
        console.log("we are here")
        let information = JSON.parse(this.responseText);
        date = information["dates"]
        price = information["prices"]
      }

    }
    xhr.send();

    return [date,price]
  }



</script>

<script type="text/javascript"
    src="{{ url_for('static', filename='stock.js')}}">
</script> 

{% endblock %}